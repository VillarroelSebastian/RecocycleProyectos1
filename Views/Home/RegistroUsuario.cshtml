@{
    ViewData["Title"] = "Registro ";
}

<link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
<link rel="stylesheet" href="~/css/EstilosUsuarios/styleRegistroUsuario.css" asp-append-version="true" />
<link rel="stylesheet" href="~/Web_Recocycle.styles.css" asp-append-version="true" />
<script src="~/js/registro.js"></script>

<div class="screen">
</div>

<div class="container-welcome">
    <div class="header">
        <img src="~/imagenes/logo.png" alt="Logo" class="logo" />
        <div class="title">
            <h1>REGISTRO DE DATOS</h1>
            <hr />
        </div>
    </div>

    <div class="options">
    <div class="card">
            <form asp-action="Registrar" method="post">
            <div class="form-container">
                <div class="form-group">
                    <label for="Nombres">Nombre Completo:</label>
                    <input type="text" id="Nombres" name="Nombres" required>
                        <div id="mensajeNombres" style="color:red; margin-top:3px;"></div>
                </div>
                <div class="form-group">
                    <label for="Apellidos">Apellidos:</label>
                    <input type="text" id="Apellidos" name="Apellidos" required>
                        <div id="mensajeApellidos" style="color:red; margin-top:3px;"></div>
                </div>
                <div class="form-group">
                    <label for="Telefono">Teléfono:</label>
                        <input type="text" id="Telefono" name="Telefono" onblur="validarTelefono()" required>
                        <div id="mensajeTelefono" style="color:red; margin-top:3px;"></div>
                </div>
                <div class="form-group">
                    <label for="Genero">Género:</label>
                    <select id="Genero" name="Genero" v0>
                        <option value="M">Masculino</option>
                        <option value="F">Femenino</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="Correo">Correo electrónico:</label>
                    <input type="email" id="Correo" name="Correo" required>
                    <div id="mensajeCorreo" style="color:red; margin-top:3px;"></div>
                </div>
                <div class="form-group">
                    <label for="Contrasenia">Contraseña:</label>
                    <input type="password" id="Contrasenia" name="Contrasenia">
                        <span id="mensajeContrasenia" style="color:red; font-size:14px;"></span>
                </div>
                <div class="form-group">
                    <label for="ConfirmContrasenia">Confirmar contraseña:</label>
                        <input type="password" id="ConfirmContrasenia" name="ConfirmContrasenia" 
                            onkeyup="validarConfirmacion()" onblur="validarConfirmacion()">
                        <span id="mensajeConfirmacion" style="color:red; font-size:14px;"></span>
                </div>
            </div>

            <div class="boton">
                <a asp-action="Index" class="btn btnC">CANCELAR</a>

                <button type="submit" class="btn btnG">GUARDAR</button>
            </div>

                @section Scripts {
                    <script>
                        $(document).ready(function () {
                        @{
                                int? registro = TempData["RegistroExitoso"] as int?;
                        }

                        @if (registro == 1)
                        {
                                <text>registroConfirmado();</text>
                        }
                        else if (registro == 2)
                        {
                                <text>registroNoConfirmado();</text>
                        }
                        else if (registro == 3)
                        {
                                <text>correoExiste();</text>
                        }
                        else if (registro == 4)
                        {
                            <text>
                                Swal.fire({
                                    title: '<span style="font-size:35px; font-weight:bold; color:white;">ERROR CONTRASEÑA INVALIDA</span>',
                                    html: `
                                        <p style="font-size:25px; margin:10px 0; color:white;">
                                                    Debe tener mínimo 8 caracteres, una mayúscula, un número y un caracter especial.
                                        </p>`,
                                    icon: 'warning',
                                    confirmButtonText: 'CERRAR',
                                    confirmButtonColor: '#8B0000',
                                    background: 'linear-gradient(#064d1a, black)'
                                });
                            </text>
                        }
                        else if (registro == 5)
                        {
                            <text>

                                 Swal.fire({
                                    title: '<span style="font-size:35px; font-weight:bold; color:white;">ERROR AL CONFIRMAR CONTRASEÑA</span>',
                                    html: `
                                        <p style="font-size:25px; margin:10px 0; color:white;">
                                                Las contraseñas no coinciden.
                                        </p>`,
                                    icon: 'warning',
                                    confirmButtonText: 'CERRAR',
                                    confirmButtonColor: '#8B0000',
                                    background: 'linear-gradient(#064d1a, black)'
                                });
                            </text>
                        }

                        });

                        function registroConfirmado() {
                            Swal.fire({
                                title: '<span style="font-size:35px; font-weight:bold; color:white;">REGISTRO CONFIRMADO</span>',
                                html: `
                                    <p style="font-size:25px; margin:10px 0; color:white;">
                                        Los datos ingresados fueron guardados correctamente.
                                    </p>
                                `,
                                icon: 'success',
                                confirmButtonText: 'CERRAR',
                                confirmButtonColor: '#8B0000',
                                background: 'linear-gradient(#064d1a, black)'
                            }).then(() => {
                                window.location.href = '@Url.Action("Index", "Home")';
                            });
                        }

                        function registroNoConfirmado() {
                            Swal.fire({
                                title: '<span style="font-size:35px; font-weight:bold; color:white;">REGISTRO NO CONFIRMADO</span>',
                                html: `
                                    <p style="font-size:25px; margin:10px 0; color:white;">
                                        Ha ocurrido un error vuelve a intentarlo más tarde.
                                    </p>
                                `,
                                icon: 'error',
                                confirmButtonText: 'CERRAR',
                                confirmButtonColor: '#8B0000',
                                background: 'linear-gradient(#064d1a, black)'
                            }).then(() => {
                                window.location.href = '@Url.Action("RegistroUsuario", "Home")';
                            });
                        }

                        function correoExiste() {
                            Swal.fire({
                                title: '<span style="font-size:35px; font-weight:bold; color:white;">CORREO EXISTENTE</span>',
                                html: `
                                    <p style="font-size:25px; margin:10px 0; color:white;">
                                        El correo ingresado ya está registrado. Intente con otro.
                                    </p>`,
                                icon: 'warning',
                                confirmButtonText: 'CERRAR',
                                confirmButtonColor: '#8B0000',
                                background: 'linear-gradient(#064d1a, black)'
                            });
                        }

                        function validarTelefono() {
                            var telefono = $('#Telefono').val();

                            if (!telefono) return; // no validar si está vacío

                            $.ajax({
                                type: "POST",
                                url: '@Url.Action("ValidarTelefono", "Home")',
                                data: { telefono: telefono },
                                success: function(response) {
                                    if (!response.telefonoValido) {
                                        $('#mensajeTelefono').text("El teléfono no es válido. Debe tener 8 dígitos.");
                                    } else {
                                        $('#mensajeTelefono').text(""); // limpio el mensaje si es válido
                                    }
                                },
                                error: function() {
                                    $('#mensajeTelefono').text("Error al validar el teléfono.");
                                }
                            });
                        }

                        function validarConfirmacion() {
                            var contrasenia = document.getElementById("Contrasenia").value;
                            var confirm = document.getElementById("ConfirmContrasenia").value;
                            var mensaje = document.getElementById("mensajeConfirmacion");

                            if (contrasenia !== confirm) {
                                mensaje.textContent = "Las contraseñas no coinciden.";
                                return false;
                            } else {
                                mensaje.textContent = "";
                                return true;
                            }
                        }
                    </script>
                }
        </form>
    </div>
</div>

    <footer>
    </footer>
</div>
