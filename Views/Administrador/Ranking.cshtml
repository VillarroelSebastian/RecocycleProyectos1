@model List<Web_Recocycle.Models.Reciclador>
@{
    ViewData["Title"] = "Ranking de Recicladores";
    Layout = null;
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="~/css/EstilosAdministrador/globals.css" />
    <link rel="stylesheet" href="~/css/EstilosAdministrador/style.css" />
    <link rel="stylesheet" href="~/css/EstilosAdministrador/Ranking.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    @Html.Partial("_MenuAdministrador")

    <div class="main-content">
        <div class="ranking-header">
            <h2>Ranking de Recicladores</h2>
            <button class="btn-imagen" id="btnResetearPuntos" type="button"></button>
        </div>

        @if (Model == null || !Model.Any())
        {
            <p>No hay datos en el ranking.</p>
        }
        else
        {
            <ol class="ranking-list">
                @for (int i = 0; i < Model.Count; i++)
                {
                    var r = Model[i];
                    <li class="rank-item rank-@((i + 1))">
                        <span class="position">@((i + 1)).</span>

                        <img class="imgPerfil"
                             src="@(r.ImgPerfil != null ? $"data:image/jpeg;base64,{Convert.ToBase64String(r.ImgPerfil)}" : Url.Content("~/imagenes/PerfilPredeterminado.jpg"))"
                             alt="Foto de @r.Nombres" />

                        <span class="name">@r.Nombres @r.Apellidos</span>

                        <span class="points">@r.Puntos pts</span>

                        @* Mostrar teléfono y correo directamente, porque Reciclador hereda de Usuario *@
                        <div class="contacto">
                            <span>📞 @r.Telefono</span>
                            <span>✉️ @r.Correo</span>
                        </div>
                    </li>
                }
            </ol>
        }
    </div>

    <script>
        document.getElementById("btnResetearPuntos").addEventListener("click", function () {
            Swal.fire({
                title: '<span style="font-size:26px; font-weight:bold; color:white;">Resetear Puntos</span>',
                html: `
                    <p style="font-size:18px; color:white;">Ingrese el porcentaje que desea aplicar:</p>
                    <input type="number" id="porcentajeInput" class="swal2-input" placeholder="Ej: 50" min="1" max="100" />
                `,
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Aplicar',
                cancelButtonText: 'Cancelar',
                confirmButtonColor: '#1e4d3a',
                background: 'linear-gradient(#064d1a, black)',
                preConfirm: () => {
                    const valor = parseInt(document.getElementById('porcentajeInput').value);
                    if (isNaN(valor) || valor < 1 || valor > 100) {
                        Swal.showValidationMessage('Ingrese un valor entre 1 y 100');
                        return false;
                    }
                    return valor;
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const porcentaje = result.value;
                    window.location.href = `/Administrador/ResetearPuntos?porcentaje=${porcentaje}`;
                }
            });
        });
    </script>
</body>
</html>
